<%- param = params[:p] || 'n' -%>
<div class="tab-body">
  <h2><%= Survey.title_for_parameter(param) %></h2>
  <h3><%= Survey.question_for_parameter(param) %></h3>
	
  <label>Show age:</label>
  <select>
    <option disabled="disabled">Choose:</option>
    <option>11 and under</option>
    <option>12-14</option>
    <option>15-18</option>
    <option>19-25</option>
    <option selected="selected">26-35</option>
    <option>36-50</option>
    <option>50+</option>
    <option>Unknown</option>
  </select>
	
  <div id="ages-group" style="width: 650px; height: 300px;"></div>

  <table id="data-ages-group" style="display:none;">
    <caption>Estimates by age group 26-35</caption>
    <thead>
      <tr>
        <th>Value</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      <%- chart_columns(param).each do |col| -%>
      <tr>
        <th><%= col %></th>
        <td>1234</td>
      </tr>
      <%- end -%>
    </tbody>
  </table>

  <label>Show gender:</label>
  <select>
    <option disabled="disabled">Choose:</option>
    <option selected="selected">Male</option>
    <option>Female</option>
    <option>Unknown</option>
  </select>

  <div id="gender-group" style="width: 650px; height: 300px;"></div>

  <table id="data-gender-group" style="display:none;">
    <caption>Estimates for age 26-35</caption>
    <thead>
      <tr>
        <th>Value</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      <%- chart_columns(param).each do |col| -%>
      <tr>
        <th><%= col %></th>
        <td>1234</td>
      </tr>
      <%- end -%>
    </tbody>
  </table>

  <div id="all" style="width: 650px; height: 300px;"></div>

  <table id="data-all" style="display:none;">
    <caption>All Estimates</caption>
    <tbody>
      <%- chart_columns(param).each do |col| -%>
      <tr>
        <th><%= col %></th>
        <td>1234</td>
      </tr>
      <%- end -%>
    </tbody>
  </table>

</div>

<script>
var categories = [ '<%= chart_columns(param).join("', '") %>' ];

function makeChart(group, title) {
  return new Highcharts.Chart({
    chart: {
      renderTo: group,
      defaultSeriesType: 'column'
    },
    title: {
      text: title
    },
    xAxis: {
      categories: categories
    },
    yAxis: {
      title: {
	text: 'Number of Responses'
      }
    },
    tooltip: {
      formatter: function() {
	return '' + this.y +' users responded with '+ this.x.toLowerCase();
      }
    },
    plotOptions: {
      column: {
	data: 'data-' + group,
	// define a custom data parser function for both series
	dataParser: function(data) {
	  var table = document.getElementById(data),
	  // get the data rows from the tbody element
	  rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr'),
	  // define the array to hold the real data
	  result = [], 
	  // decide which column to use for this series
	  column = { 'Count': 0 }[this.options.name];
	  
	  // loop through the rows and get the data depending on the series (this) name
	  for (var i = 0; i < rows.length; i++) {						
	    result.push(
	      parseInt(
		rows[i].getElementsByTagName('td')[column]. // the data cell
		innerHTML
	      )
	    );
	  }
	  return result;
	}
      }
    },
    credits: {
      enabled: false
    },
    legend: {
      enabled: false
    },
    series: [{
      name: 'Count'
    }]
  });
}

$(document).ready(function() {
  makeChart('ages-group', 'Estimates by age group 26-35');
  makeChart('gender-group', 'Estimates by males');
  makeChart('all', 'All Estimates');
});

</script>
